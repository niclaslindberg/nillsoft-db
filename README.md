# A simple Mysql PHP wrapper.
Main features of webx-db are:
* Name based auto-escaped parametrization.
* Nested transactions by using `savepoint X` and `rollback to savepoint X` in inner transactions.
* Key violation exception with name of violated key.

## Getting started
```php
    use WebX\Db\Db;
    use WebX\Db\Impl\DbImpl;

    $db = new DbImpl([
        "user" => "mysqlUser",
        "password" => "mysqlPassword",
        "database" => "mysqlDatabase"
    ]);
```
### A simple insert
```php
    $person = ["firstName"=>"Alex", "lastName"=>"Morris","email"=>"alex.morris@somewhere.com"];
    $db->execute("INSERT INTO people (firstName,lastName,email) VALUES(:firstName,:lastName,email)", $person);

    $id = $db->insertId();          //The value of the autogenerated primary key.
```

### A simple select
```php
    foreach($db->allRows("SELECT * FROM table") as $row) {
        echo($row['firstName']);
        echo($row['lastName']);
    }
```

### Insert with key violations
```php
    $person = [...];
    try {
        $db->execute("INSERT INTO people (firstName,lastName,email) VALUES(:firstName,:lastName,email)", $person);
        echo("Person registered");
    } catch(DbKeyException $e) {
        if($e->key()==='emailKey') { // Name of the defined unique key in MySQL
            echo("The email is already registered";
        } else {
            echo("Some other key violation occured.");
        }
    }


```
### Nested transactions
```php

    $db->startTx();
    $db->execute("INSERT INTO table (col) VALUES("1"));

    $db->startTx();
    $db->execute("INSERT INTO table (col) VALUES("2"));
    $db->rollbackTx();

    $db->startTx();
    $db->execute("INSERT INTO table (col) VALUES("3"));
    $db->commitTx();

    $db->commitTx();

```
Database content after the above code is run.
|col|
|1|
|3|


## How to run tests
In the root of the project:

  `composer install`

  `phpunit -c tests`

